{{ $operatorsParam := .Get "operators" }}
{{ $operators := split $operatorsParam "," }}
{{ $lang := .Site.Language.Lang }}

{{ $operatorData := slice }}

{{ range $operators }}
  {{ $operator := strings.TrimSpace . }}
  {{ $dir := printf "data/operator-search/%s" $operator }}
  {{ $file := printf "%s/index.%s.md" $dir $lang }}

  {{ if not (fileExists $file) }}
    {{ errorf "❌ Missing operator-search markdown: %q (language: %s)" $file $lang }}
  {{ end }}

  {{ $raw := readFile $file }}

  {{ $url := "" }}
  {{ $title := "" }}
  {{ $content := $raw }}

  {{ if strings.Contains $raw "---" }}
    {{ $parts := split $raw "---" }}
    {{ if ge (len $parts) 3 }}
      {{ $frontmatterStr := index $parts 1 }}
      {{ range split $frontmatterStr "\n" }}
        {{ if strings.Contains . "url:" }}
          {{ $url = trim (index (split . "url:") 1) "\" \n\r" }}
        {{ end }}
        {{ if strings.Contains . "title:" }}
          {{ $title = trim (index (split . "title:") 1) "\" \n\r" }}
        {{ end }}
      {{ end }}
      {{ $content = strings.TrimSpace (index $parts 2) }}
    {{ end }}
  {{ end }}

  {{ $imagePath := printf "images/operator-search/%s.webp" $operator }}
  {{ $imagePathLang := printf "images/operator-search/%s.%s.webp" $operator $lang }}
  {{ $imageResource := "" }}
  {{ with resources.Get $imagePathLang }}
    {{ $imageResource = . }}
  {{ else }}
    {{ with resources.Get $imagePath }}
      {{ $imageResource = . }}
    {{ end }}
  {{ end }}

  {{ if not $imageResource }}
    {{ errorf "❌ Missing image for operator-search: %q (language: %s). Expected %q or %q" $operator $lang $imagePathLang $imagePath }}
  {{ end }}

  {{ $item := dict
    "title" $title
    "image_resource" $imageResource
    "url" $url
    "content" $content
  }}

  {{ $operatorData = $operatorData | append $item }}
{{ end }}

{{ $params := dict
  "operators" $operatorData
  "original_page" .Page
}}


<details class="details-screen o-expander o-expander--operator-search">
  {{- partial "operator-search" $params -}}
</details>

<details open class="details-print o-expander o-expander--operator-search">
  {{- partial "operator-search" $params -}}
</details>
